/**
 * jquery.myData - Small JQuery&Zepto plugin for two-ways data binding.
 * @version v0.2.0
 * @link https://github.com/ange007/JQuery.myData
 * @license MIT
 * @author Borisenko Vladimir
 */

"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if((typeof exports==="undefined"?"undefined":_typeof(exports))==="object"){module.exports=e(window.Zepto||window.jQuery||window.$||require("jquery"),window,document)}else{e(window.Zepto||window.jQuery||window.$,window,document)}})(function($,window,document){"use strict";var pluginName="myData";var isJQ=!!window.jQuery;var Plugin=function e(t,n,a){this.bindings=[];this.checkTimer=undefined;this.element=$(t);this.debug=true;this.callbacks={};this.keys={event:"data-on","event-value":"data-on-value",data:"data-bind"};if((typeof n==="undefined"?"undefined":_typeof(n))==="object"&&n.hasOwnProperty("event")&&n.hasOwnProperty("data")){this.eventTarget=n["event"];this.dataTarget=n["data"];this.debug=n["debug"]||this.debug;if(_typeof(n["data-keys"])==="object"){this.keys={event:n["data-keys"]["event"]||this.keys["event"],"event-value":n["data-keys"]["event-value"]||this.keys["event-value"],data:n["data-keys"]["data"]||this.keys["data"]}}}else{this.eventTarget=n;this.dataTarget=n}if(typeof a==="function"){this.callbacks.main=a}else if((typeof a==="undefined"?"undefined":_typeof(a))==="object"){this.callbacks=a}this.bind()};Plugin.prototype={bind:function t(){var e=this;this.element.find("["+this.keys["data"]+"]").each(function(t,n){var a=$(n);var i=a.attr(e.keys["data"])||"";if(i===""){return}e.bindings.push({element:n,property:i,value:undefined})});this._setEventListeners();this._setCheckTimer()},unbind:function n(){this.element.off("."+pluginName,"["+this.keys["data"]+"]").off("."+pluginName,"["+this.keys["event"]+"]").off("."+pluginName,"["+this.keys["event-value"]+"]");clearInterval(this.checkTimer);this.bindings=[]},_setEventListeners:function _setEventListeners(){var context=this;var bindEvents=["change","keydown","input","paste"].map(function(e){return e+="."+pluginName});var onEvents=["click","dblclick","change","input","paste","load","unload","select","resize","scroll","submit","error","keydown","keyup","keypress","mouseover","mousedown","mouseup","mousemove","mouseout","mouseenter","mouseleave","blur","focus","focusin","focusout"].map(function(e){return e+="."+pluginName});this.element.on(bindEvents.join(" "),"["+this.keys["data"]+"]",function(e){var t=$(e.target);var n=t.attr(context.keys["data"]);var a="set"+n.charAt(0).toUpperCase()+n.substr(1);var i=undefined;for(var o in context.bindings){var s=context.bindings[o];if(s.element!==e.target||s.property!==n){continue}i=context._readElementValue(t,s.value);if(i!==s.value){s.value=i;if(typeof context.dataTarget[a]==="function"){context.dataTarget[a].apply(context.dataTarget,[i])}else if(typeof context.dataTarget[n]==="function"){context.dataTarget[n].apply(context.dataTarget,[i])}else if(context.dataTarget.hasOwnProperty(n)){context.dataTarget[n]=i}break}}if(typeof context.callbacks.set==="function"){context.callbacks.set(t,n,i)}else if(typeof context.callbacks.main==="function"){context.callbacks.main("set",t,n,i)}});this.element.on(onEvents.join(" "),"["+this.keys["event"]+"]",function(event){var element=$(this);var actionData=element.attr(context.keys["event"]);var actionList=[];if(typeof actionData!=="string"){context._debug("Empty data in ["+context.keys["event"]+"].","","error");return}else{actionList=actionData.indexOf("[")===0?(actionData.match(/[\[\{}](.*?)[\}\]]/)[1]||"").split(","):[actionData]}actionList.forEach(function(action,i,arr){var onData=action.indexOf(":")>=0?action.split(":"):["click",action];var eventTypes=onData[0].trim().split(",");var handlerName=onData[1].trim();var handlerFunc=handlerName.match(/([a-zA-Z0-9,\.\-_\/]+)(?:\(([^)]+)\))?$/)||false;if(eventTypes.indexOf(event.type)<0){return}if(handlerFunc){var name=handlerFunc[1];var args=typeof handlerFunc[2]==="string"?handlerFunc[2].split(",").map(function(e){return e.trim().match(/^['"]{0,}(.*?)['"]{0,}$/)[1]||""}):[];var targetFuncExist=context.eventTarget!==undefined&&typeof context.eventTarget[name]==="function";var windowFuncExist=typeof window[name]==="function";var value=context._readElementValue(element,undefined);var callArgs=[element,value].concat([args,event]);var result=undefined;if(targetFuncExist){result=context.eventTarget[name].apply(context.eventTarget,callArgs)}else{try{result=eval(name).apply(window,callArgs)}catch(err){context._debug('Could not call - "'+name+'"',"","warn")}}if(typeof context.callbacks.on==="function"){context.callbacks.on(element,event.type,{name:name,value:value})}else if(typeof context.callbacks.main==="function"){context.callbacks.main("on",element,event.type,{name:name,value:value})}if(result===false){event.stopPropagation();return false}else result===true;{event.preventDefault();return true}}})})},_setCheckTimer:function a(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:250;var t=this;this.checkTimer=setInterval(function(){for(var e in t.bindings){var n=t.bindings[e];var a=$(n.element);var i=n.property;var o=n.value;var s="";var r="get"+i.charAt(0).toUpperCase()+i.substr(1);if(typeof t.dataTarget[r]==="function"){s=t.dataTarget[r]()}else if(typeof t.dataTarget[i]==="function"){s=t.dataTarget[i]()}else if(t.dataTarget.hasOwnProperty(i)){s=t.dataTarget[i]}if(s!==o){n.value=s;if(a.is('input[type="checkbox"]')||a.is('input[type="radio"]')){$(a).attr("checked",s)}else if(a.is("select")||a.is("input")||a.is("textarea")){$(a).val(s)}else{$(a).html(s)}if(typeof t.callbacks.get==="function"){t.callbacks.get(a,i,s)}else if(typeof t.callbacks.main==="function"){t.callbacks.main("get",a,i,s)}}}},e)},_readElementValue:function i(e,t){var n=undefined;if(e.is('input[type="checkbox"]')||e.is('input[type="radio"]')){if(typeof t==="boolean"||$(e).attr("value")===undefined){n=$(e).is(":checked")}else{n=$(e).val()}}else if(e.is("select")){if(typeof t==="number"){n=$(e).find(":selected").index()}else{n=$(e).val()}}else if(e.is("input")||e.is("textarea")){n=$(e).val()}else{n=$(e).attr("value")||$(e).attr(this.keys["event-value"])||$(e).html()}return n},_debug:function o(e,t,n){var n=n||"warn";if(!this.debug||e===""){return}console[n].apply(n,["jQuery.myData: "+e,t])},destroy:function s(){this.unbind()}};$.fn[pluginName]=function(e,t){var n=arguments;if(e===undefined||(typeof e==="undefined"?"undefined":_typeof(e))==="object"){this.each(function(){var n=isJQ?$(this).data("_"+pluginName):$(this)[0]["_"+pluginName];var a=(typeof e==="undefined"?"undefined":_typeof(e))==="object"&&e.hasOwnProperty("exlusive")?"":Math.random().toString(36).substring(7);if(!n||a!==""){var i=new Plugin(this,e,t);if(isJQ){$(this).data("_"+pluginName,i)}else{$(this)[0]["_"+pluginName]=i}}});return $(this)}else if(typeof e==="string"&&e[0]!=="_"&&e!=="init"){var a=undefined;this.each(function(){var t=isJQ?$(this).data("_"+pluginName):$(this)[0]["_"+pluginName];if(t instanceof Plugin&&typeof t[e]==="function"){a=t[e].apply(t,Array.prototype.slice.call(n,1))}});return a!==undefined?a:$(this)}}});